# .github/workflows/tingnotes-seo-optimizer.yml
name: TingNotes æ™ºèƒ½ SEO å„ªåŒ–å™¨

on:
  push:
    branches: [ main ]
    paths:
      - 'index.html'
      - 'Learning/index.html'
      - 'Career/index.html'
      - 'Travel/index.html'
      - 'Others/index.html'
      - '*/index.html'
      - 'c-pointer-tutorial/**'
  
  schedule:
    - cron: '0 2 * * 1'  # æ¯é€±ä¸€å‡Œæ™¨ 2 é»è‡ªå‹•ç¶­è­·

jobs:
  seo-optimization:
    runs-on: ubuntu-latest
    
    steps:
    # ğŸ”§ åŸºç¤è¨­ç½®
    - name: ğŸš€ æª¢å‡ºä»£ç¢¼
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: âš™ï¸ è¨­ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    # ğŸŒ ç¶²ç«™å¥åº·æª¢æŸ¥
    - name: ğŸ¥ ç¶²ç«™å¥åº·æª¢æŸ¥
      run: |
        echo "ğŸ” åŸ·è¡Œç¶²ç«™å¥åº·æª¢æŸ¥..."
        
        # ä¸»è¦é é¢åˆ—è¡¨
        declare -A pages=(
          ["é¦–é "]="https://tingnotes.io/"
          ["å­¸ç¿’å°ˆå€"]="https://tingnotes.io/Learning/"
          ["CæŒ‡æ¨™æ•™å­¸"]="https://tingnotes.io/c-pointer-tutorial/"
          ["è·æ¶¯å°ˆå€"]="https://tingnotes.io/Career/"
          ["æ—…éŠå°ˆå€"]="https://tingnotes.io/Travel/"
          ["é›œäº‹åˆ†äº«"]="https://tingnotes.io/Others/"
        )
        
        echo "ğŸ“Š å¥åº·æª¢æŸ¥å ±å‘Š:" > health_report.txt
        echo "==================" >> health_report.txt
        
        all_healthy=true
        
        for name in "${!pages[@]}"; do
          url="${pages[$name]}"
          echo "æª¢æŸ¥ $name..."
          
          # æª¢æŸ¥ HTTP ç‹€æ…‹ç¢¼å’Œå›æ‡‰æ™‚é–“
          response=$(curl -s -w "HTTPSTATUS:%{http_code};TIME:%{time_total}" "$url" || echo "HTTPSTATUS:000;TIME:0")
          status=$(echo "$response" | grep -o "HTTPSTATUS:[0-9]*" | cut -d: -f2)
          time=$(echo "$response" | grep -o "TIME:[0-9.]*" | cut -d: -f2)
          
          if [ "$status" = "200" ]; then
            echo "âœ… $name: OK (${time}s)" | tee -a health_report.txt
          else
            echo "âŒ $name: Error $status" | tee -a health_report.txt
            all_healthy=false
          fi
        done
        
        echo "" >> health_report.txt
        if [ "$all_healthy" = true ]; then
          echo "ğŸ‰ æ‰€æœ‰é é¢é‹ä½œæ­£å¸¸ï¼" >> health_report.txt
        else
          echo "âš ï¸ ç™¼ç¾å•é¡Œé é¢ï¼Œè«‹æª¢æŸ¥ï¼" >> health_report.txt
        fi

    # ğŸ“Š æ™ºèƒ½ç¶²ç«™åˆ†æ
    - name: ğŸ“ˆ æ™ºèƒ½ç¶²ç«™åˆ†æ
      run: |
        echo "ğŸ“Š åˆ†æç¶²ç«™çµæ§‹å’Œå…§å®¹..."
        
        cat > analyze-website.js << 'EOF'
        const fs = require('fs');
        const path = require('path');

        function analyzeWebsite() {
          const analysis = {
            structure: {
              totalFiles: 0,
              htmlFiles: 0,
              cssFiles: 0,
              jsFiles: 0,
              imageFiles: 0,
              totalSize: 0
            },
            projects: [],
            seoHealth: {
              pagesWithTitle: 0,
              pagesWithDescription: 0,
              pagesWithCanonical: 0,
              totalPages: 0
            },
            performance: {
              largeImages: [],
              largeCssFiles: [],
              unusedFiles: []
            }
          };

          function scanDirectory(dir, isRoot = false) {
            try {
              const files = fs.readdirSync(dir, { withFileTypes: true });
              
              files.forEach(file => {
                const fullPath = path.join(dir, file.name);
                
                if (file.isDirectory() && !file.name.startsWith('.') && file.name !== 'node_modules') {
                  scanDirectory(fullPath);
                  
                  // æª¢æŸ¥æ˜¯å¦ç‚ºå°ˆæ¡ˆç›®éŒ„
                  if (fs.existsSync(path.join(fullPath, 'index.html'))) {
                    const projectInfo = analyzeProject(fullPath);
                    analysis.projects.push(projectInfo);
                  }
                } else if (file.isFile()) {
                  analyzeFile(fullPath, analysis);
                }
              });
            } catch (error) {
              console.log(`ç„¡æ³•æƒæç›®éŒ„ ${dir}: ${error.message}`);
            }
          }

          function analyzeFile(filePath, analysis) {
            try {
              const stats = fs.statSync(filePath);
              const ext = path.extname(filePath).toLowerCase();
              
              analysis.structure.totalFiles++;
              analysis.structure.totalSize += stats.size;

              switch(ext) {
                case '.html':
                  analysis.structure.htmlFiles++;
                  analyzeSEO(filePath, analysis);
                  break;
                case '.css':
                  analysis.structure.cssFiles++;
                  if (stats.size > 100000) { // å¤§æ–¼ 100KB
                    analysis.performance.largeCssFiles.push({
                      file: filePath,
                      size: Math.round(stats.size / 1024) + ' KB'
                    });
                  }
                  break;
                case '.js':
                  analysis.structure.jsFiles++;
                  break;
                case '.jpg':
                case '.jpeg':
                case '.png':
                case '.gif':
                case '.webp':
                  analysis.structure.imageFiles++;
                  if (stats.size > 500000) { // å¤§æ–¼ 500KB
                    analysis.performance.largeImages.push({
                      file: filePath,
                      size: Math.round(stats.size / 1024) + ' KB'
                    });
                  }
                  break;
              }
            } catch (error) {
              console.log(`ç„¡æ³•åˆ†ææª”æ¡ˆ ${filePath}: ${error.message}`);
            }
          }

          function analyzeProject(projectPath) {
            const projectName = path.basename(projectPath);
            const indexPath = path.join(projectPath, 'index.html');
            let projectInfo = {
              name: projectName,
              path: projectPath,
              hasIndex: false,
              title: '',
              description: '',
              chapters: 0
            };

            if (fs.existsSync(indexPath)) {
              projectInfo.hasIndex = true;
              const content = fs.readFileSync(indexPath, 'utf8');
              
              // æå–æ¨™é¡Œ
              const titleMatch = content.match(/<title[^>]*>([^<]+)<\/title>/i);
              if (titleMatch) {
                projectInfo.title = titleMatch[1].trim();
              }
              
              // æå–æè¿°
              const descMatch = content.match(/<meta[^>]+name=["']description["'][^>]+content=["']([^"']+)["']/i);
              if (descMatch) {
                projectInfo.description = descMatch[1].trim();
              }
              
              // è¨ˆç®—ç« ç¯€æ•¸ï¼ˆå¦‚æœæ˜¯æ•™å­¸å°ˆæ¡ˆï¼‰
              const chaptersDir = path.join(projectPath, 'chapters');
              if (fs.existsSync(chaptersDir)) {
                const chapters = fs.readdirSync(chaptersDir).filter(f => f.endsWith('.html'));
                projectInfo.chapters = chapters.length;
              }
            }

            return projectInfo;
          }

          function analyzeSEO(htmlFile, analysis) {
            try {
              const content = fs.readFileSync(htmlFile, 'utf8');
              analysis.seoHealth.totalPages++;

              if (content.includes('<title>')) {
                analysis.seoHealth.pagesWithTitle++;
              }
              
              if (content.includes('name="description"')) {
                analysis.seoHealth.pagesWithDescription++;
              }
              
              if (content.includes('rel="canonical"')) {
                analysis.seoHealth.pagesWithCanonical++;
              }
            } catch (error) {
              console.log(`ç„¡æ³•åˆ†æ SEO: ${htmlFile}`);
            }
          }

          scanDirectory('.');
          
          // è¨ˆç®— SEO å¥åº·åº¦åˆ†æ•¸
          analysis.seoHealth.score = Math.round(
            ((analysis.seoHealth.pagesWithTitle + 
              analysis.seoHealth.pagesWithDescription + 
              analysis.seoHealth.pagesWithCanonical) / 
             (analysis.seoHealth.totalPages * 3)) * 100
          );

          return analysis;
        }

        const analysis = analyzeWebsite();

        console.log('ğŸ“Š TingNotes ç¶²ç«™åˆ†æå ±å‘Š');
        console.log('==========================');
        console.log(`ğŸ“ æª”æ¡ˆçµæ§‹:`);
        console.log(`   ç¸½æª”æ¡ˆæ•¸: ${analysis.structure.totalFiles}`);
        console.log(`   HTML: ${analysis.structure.htmlFiles} | CSS: ${analysis.structure.cssFiles} | JS: ${analysis.structure.jsFiles} | åœ–ç‰‡: ${analysis.structure.imageFiles}`);
        console.log(`   ç¸½å¤§å°: ${Math.round(analysis.structure.totalSize / 1024)} KB`);
        
        console.log(`\nğŸš€ å°ˆæ¡ˆåˆ†æ:`);
        analysis.projects.forEach(project => {
          console.log(`   ğŸ“š ${project.name}: ${project.chapters ? project.chapters + ' ç« ç¯€' : 'æ¨™æº–é é¢'}`);
        });
        
        console.log(`\nğŸ¯ SEO å¥åº·åº¦: ${analysis.seoHealth.score}%`);
        console.log(`   æœ‰æ¨™é¡Œçš„é é¢: ${analysis.seoHealth.pagesWithTitle}/${analysis.seoHealth.totalPages}`);
        console.log(`   æœ‰æè¿°çš„é é¢: ${analysis.seoHealth.pagesWithDescription}/${analysis.seoHealth.totalPages}`);
        
        if (analysis.performance.largeImages.length > 0) {
          console.log(`\nâš ï¸ å¤§åœ–ç‰‡æª”æ¡ˆ (>500KB):`);
          analysis.performance.largeImages.forEach(img => {
            console.log(`   ğŸ“¸ ${img.file}: ${img.size}`);
          });
        }

        // å„²å­˜åˆ†æçµæœ
        fs.writeFileSync('website-analysis.json', JSON.stringify(analysis, null, 2));
        console.log('\nâœ… åˆ†æå ±å‘Šå·²å„²å­˜åˆ° website-analysis.json');
        EOF

        node analyze-website.js

    # ğŸ—ºï¸ æ™ºèƒ½ Sitemap ç”Ÿæˆ
    - name: ğŸ—ºï¸ ç”Ÿæˆæ™ºèƒ½ Sitemap
      run: |
        echo "ğŸ—ºï¸ ç”Ÿæˆæ™ºèƒ½ Sitemap..."
        
        cat > generate-smart-sitemap.js << 'EOF'
        const fs = require('fs');
        const path = require('path');

        function generateSmartSitemap() {
          const baseUrl = 'https://tingnotes.io';
          const currentDate = new Date().toISOString().split('T')[0];
          
          // æ ¸å¿ƒé é¢ - æ‰‹å‹•å®šç¾©é‡è¦é é¢
          const corePages = [
            { url: '/', priority: '1.0', changefreq: 'weekly', lastmod: currentDate },
            { url: '/Learning/', priority: '0.8', changefreq: 'weekly', lastmod: currentDate },
            { url: '/Career/', priority: '0.6', changefreq: 'monthly', lastmod: currentDate },
            { url: '/Travel/', priority: '0.6', changefreq: 'monthly', lastmod: currentDate },
            { url: '/Others/', priority: '0.6', changefreq: 'monthly', lastmod: currentDate }
          ];

          // è‡ªå‹•ç™¼ç¾å°ˆæ¡ˆé é¢
          const projectPages = [];
          
          try {
            const directories = fs.readdirSync('.', { withFileTypes: true })
              .filter(dirent => dirent.isDirectory())
              .map(dirent => dirent.name)
              .filter(name => 
                !name.startsWith('.') && 
                !['node_modules', 'Learning', 'Career', 'Travel', 'Others'].includes(name)
              );

            directories.forEach(dir => {
              const indexPath = path.join(dir, 'index.html');
              if (fs.existsSync(indexPath)) {
                // æª¢æŸ¥æ˜¯å¦ç‚ºæ•™å­¸å°ˆæ¡ˆï¼ˆå„ªå…ˆç´šè¼ƒé«˜ï¼‰
                const isEducational = dir.includes('tutorial') || dir.includes('course') || dir.includes('guide');
                
                projectPages.push({
                  url: `/${dir}/`,
                  priority: isEducational ? '0.9' : '0.7',
                  changefreq: 'monthly',
                  lastmod: getFileLastModified(indexPath)
                });

                // å¦‚æœæ˜¯æ•™å­¸å°ˆæ¡ˆï¼Œæª¢æŸ¥é‡è¦ç« ç¯€
                if (isEducational) {
                  const chaptersDir = path.join(dir, 'chapters');
                  if (fs.existsSync(chaptersDir)) {
                    try {
                      const chapters = fs.readdirSync(chaptersDir)
                        .filter(f => f.endsWith('.html'))
                        .slice(0, 5); // åªåŒ…å«å‰5å€‹é‡è¦ç« ç¯€
                      
                      chapters.forEach(chapter => {
                        projectPages.push({
                          url: `/${dir}/chapters/${chapter}`,
                          priority: '0.6',
                          changefreq: 'monthly',
                          lastmod: getFileLastModified(path.join(chaptersDir, chapter))
                        });
                      });
                    } catch (error) {
                      console.log(`ç„¡æ³•è®€å– ${chaptersDir}: ${error.message}`);
                    }
                  }
                }
              }
            });
          } catch (error) {
            console.log(`æƒæç›®éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`);
          }

          // åˆä½µæ‰€æœ‰é é¢
          const allPages = [...corePages, ...projectPages];

          // ç”Ÿæˆ XML
          let xml = `<?xml version="1.0" encoding="UTF-8"?>\n`;
          xml += `<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n`;
          
          allPages.forEach(page => {
            xml += `  <url>\n`;
            xml += `    <loc>${baseUrl}${page.url}</loc>\n`;
            xml += `    <lastmod>${page.lastmod}</lastmod>\n`;
            xml += `    <changefreq>${page.changefreq}</changefreq>\n`;
            xml += `    <priority>${page.priority}</priority>\n`;
            xml += `  </url>\n`;
          });
          
          xml += `</urlset>`;

          return { xml, pageCount: allPages.length, pages: allPages };
        }

        function getFileLastModified(filePath) {
          try {
            const stats = fs.statSync(filePath);
            return stats.mtime.toISOString().split('T')[0];
          } catch (error) {
            return new Date().toISOString().split('T')[0];
          }
        }

        const result = generateSmartSitemap();
        fs.writeFileSync('sitemap.xml', result.xml);

        console.log('ğŸ—ºï¸ æ™ºèƒ½ Sitemap ç”Ÿæˆå®Œæˆï¼');
        console.log(`ğŸ“Š åŒ…å« ${result.pageCount} å€‹é é¢`);
        
        // é¡¯ç¤ºåŒ…å«çš„é é¢
        result.pages.forEach(page => {
          console.log(`   ${page.priority} - ${page.url}`);
        });
        EOF

        node generate-smart-sitemap.js

    # ğŸ¤– å„ªåŒ– robots.txt
    - name: ğŸ¤– ç”Ÿæˆå„ªåŒ–çš„ robots.txt
      run: |
        echo "ğŸ¤– ç”Ÿæˆ SEO å„ªåŒ–çš„ robots.txt..."
        
        cat > robots.txt << 'EOF'
        # TingNotes.io - æ™ºèƒ½çˆ¬èŸ²æŒ‡å¼•
        User-agent: *
        Allow: /

        # ä¸»è¦å…§å®¹å€åŸŸ
        Allow: /Learning/
        Allow: /Career/
        Allow: /Travel/
        Allow: /Others/
        Allow: /c-pointer-tutorial/

        # ç¦æ­¢çˆ¬å–çš„ç›®éŒ„ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
        Disallow: /private/
        Disallow: /admin/
        Disallow: /temp/

        # ç¶²ç«™åœ°åœ–
        Sitemap: https://tingnotes.io/sitemap.xml

        # çˆ¬èŸ²å‹å¥½è¨­å®š
        Crawl-delay: 1

        # Google ç‰¹åˆ¥è¨­å®š
        User-agent: Googlebot
        Allow: /
        Crawl-delay: 0

        # Bing ç‰¹åˆ¥è¨­å®š  
        User-agent: Bingbot
        Allow: /
        Crawl-delay: 1
        EOF

    # ğŸ” SEO å¥åº·åº¦æª¢æŸ¥
    - name: ğŸ” SEO å¥åº·åº¦æª¢æŸ¥
      run: |
        echo "ğŸ” åŸ·è¡Œ SEO å¥åº·åº¦æª¢æŸ¥..."
        
        cat > seo-health-check.js << 'EOF'
        const fs = require('fs');
        const path = require('path');

        function checkSEOHealth() {
          const issues = [];
          const recommendations = [];
          let score = 100;

          // æª¢æŸ¥é‡è¦é é¢çš„ SEO å…ƒç´ 
          const importantPages = [
            { file: 'index.html', name: 'é¦–é ' },
            { file: 'Learning/index.html', name: 'å­¸ç¿’é é¢' },
            { file: 'c-pointer-tutorial/index.html', name: 'CæŒ‡æ¨™æ•™å­¸' }
          ];

          importantPages.forEach(page => {
            if (fs.existsSync(page.file)) {
              const content = fs.readFileSync(page.file, 'utf8');
              const pageIssues = checkPageSEO(content, page.name);
              issues.push(...pageIssues);
              score -= pageIssues.length * 5; // æ¯å€‹å•é¡Œæ‰£5åˆ†
            } else {
              issues.push(`âŒ ${page.name} æª”æ¡ˆä¸å­˜åœ¨: ${page.file}`);
              score -= 20;
            }
          });

          // æª¢æŸ¥æŠ€è¡“ SEO
          if (!fs.existsSync('sitemap.xml')) {
            issues.push('âŒ ç¼ºå°‘ sitemap.xml');
            score -= 15;
          }

          if (!fs.existsSync('robots.txt')) {
            issues.push('âŒ ç¼ºå°‘ robots.txt');
            score -= 10;
          }

          // ç”Ÿæˆå»ºè­°
          if (score >= 90) {
            recommendations.push('ğŸ‰ SEO ç‹€æ…‹å„ªç§€ï¼ç¹¼çºŒä¿æŒï¼');
          } else if (score >= 70) {
            recommendations.push('âœ… SEO ç‹€æ…‹è‰¯å¥½ï¼Œé‚„æœ‰æ”¹é€²ç©ºé–“');
          } else {
            recommendations.push('âš ï¸ SEO éœ€è¦æ”¹é€²ï¼Œè«‹è™•ç†ç™¼ç¾çš„å•é¡Œ');
          }

          return { score: Math.max(0, score), issues, recommendations };
        }

        function checkPageSEO(content, pageName) {
          const issues = [];

          // æª¢æŸ¥ title æ¨™ç±¤
          const titleMatch = content.match(/<title[^>]*>([^<]+)<\/title>/i);
          if (!titleMatch) {
            issues.push(`âŒ ${pageName}: ç¼ºå°‘ title æ¨™ç±¤`);
          } else {
            const title = titleMatch[1].trim();
            if (title.length < 10) {
              issues.push(`âš ï¸ ${pageName}: title å¤ªçŸ­ (${title.length} å­—å…ƒ)`);
            } else if (title.length > 60) {
              issues.push(`âš ï¸ ${pageName}: title å¤ªé•· (${title.length} å­—å…ƒ)`);
            }
          }

          // æª¢æŸ¥ meta description
          const descMatch = content.match(/<meta[^>]+name=["']description["'][^>]+content=["']([^"']+)["']/i);
          if (!descMatch) {
            issues.push(`âŒ ${pageName}: ç¼ºå°‘ meta description`);
          } else {
            const desc = descMatch[1].trim();
            if (desc.length < 50) {
              issues.push(`âš ï¸ ${pageName}: meta description å¤ªçŸ­ (${desc.length} å­—å…ƒ)`);
            } else if (desc.length > 160) {
              issues.push(`âš ï¸ ${pageName}: meta description å¤ªé•· (${desc.length} å­—å…ƒ)`);
            }
          }

          // æª¢æŸ¥ canonical URL
          if (!content.includes('rel="canonical"')) {
            issues.push(`âš ï¸ ${pageName}: å»ºè­°æ·»åŠ  canonical URL`);
          }

          // æª¢æŸ¥ viewport meta
          if (!content.includes('name="viewport"')) {
            issues.push(`âŒ ${pageName}: ç¼ºå°‘ viewport meta æ¨™ç±¤`);
          }

          // æª¢æŸ¥ h1 æ¨™ç±¤
          const h1Match = content.match(/<h1[^>]*>([^<]+)<\/h1>/i);
          if (!h1Match) {
            issues.push(`âš ï¸ ${pageName}: ç¼ºå°‘ h1 æ¨™ç±¤`);
          }

          return issues;
        }

        const healthCheck = checkSEOHealth();

        console.log('ğŸ” SEO å¥åº·åº¦æª¢æŸ¥å ±å‘Š');
        console.log('========================');
        console.log(`ğŸ“Š SEO åˆ†æ•¸: ${healthCheck.score}/100`);
        
        if (healthCheck.issues.length > 0) {
          console.log('\nâ— ç™¼ç¾çš„å•é¡Œ:');
          healthCheck.issues.forEach(issue => console.log(`   ${issue}`));
        }
        
        console.log('\nğŸ’¡ å»ºè­°:');
        healthCheck.recommendations.forEach(rec => console.log(`   ${rec}`));

        // å„²å­˜çµæœ
        fs.writeFileSync('seo-health-report.json', JSON.stringify(healthCheck, null, 2));
        EOF

        node seo-health-check.js

    # ğŸ“± è¡Œå‹•è£ç½®å‹å¥½åº¦æª¢æŸ¥
    - name: ğŸ“± è¡Œå‹•è£ç½®å‹å¥½åº¦æª¢æŸ¥
      run: |
        echo "ğŸ“± æª¢æŸ¥è¡Œå‹•è£ç½®å‹å¥½åº¦..."
        
        mobile_issues=0
        
        # æª¢æŸ¥ viewport meta æ¨™ç±¤
        echo "ğŸ” æª¢æŸ¥ viewport è¨­å®š..."
        find . -name "*.html" -not -path "./.git/*" | while read file; do
          if ! grep -q 'name="viewport"' "$file"; then
            echo "âš ï¸ $file ç¼ºå°‘ viewport meta æ¨™ç±¤"
            mobile_issues=$((mobile_issues + 1))
          fi
        done
        
        # æª¢æŸ¥éŸ¿æ‡‰å¼è¨­è¨ˆç›¸é—œçš„ CSS
        echo "ğŸ” æª¢æŸ¥éŸ¿æ‡‰å¼è¨­è¨ˆ..."
        if find . -name "*.css" -o -name "*.html" | xargs grep -l "@media" > /dev/null; then
          echo "âœ… ç™¼ç¾éŸ¿æ‡‰å¼è¨­è¨ˆä»£ç¢¼"
        else
          echo "âš ï¸ æœªç™¼ç¾æ˜é¡¯çš„éŸ¿æ‡‰å¼è¨­è¨ˆä»£ç¢¼"
        fi
        
        echo "ğŸ“± è¡Œå‹•è£ç½®å‹å¥½åº¦æª¢æŸ¥å®Œæˆ"

    # ğŸ’¾ æäº¤è®Šæ›´
    - name: ğŸ’¾ æäº¤ SEO å„ªåŒ–æª”æ¡ˆ
      id: commit
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "TingNotes SEO Bot"
        
        # æª¢æŸ¥æ˜¯å¦æœ‰è®Šæ›´
        if [[ `git status --porcelain` ]]; then
          git add sitemap.xml robots.txt website-analysis.json seo-health-report.json health_report.txt
          git commit -m "ğŸ¤– TingNotes SEO è‡ªå‹•å„ªåŒ–: sitemap + å¥åº·æª¢æŸ¥ + åˆ†æå ±å‘Š"
          git push
          echo "changes_made=true" >> $GITHUB_OUTPUT
          
          # è¨˜éŒ„è®Šæ›´çš„æª”æ¡ˆ
          git diff --name-only HEAD~1 HEAD > changed_files.txt
          echo "ğŸ“ è®Šæ›´çš„æª”æ¡ˆ:"
          cat changed_files.txt
        else
          echo "changes_made=false" >> $GITHUB_OUTPUT
          echo "â„¹ï¸ æ²’æœ‰æª”æ¡ˆéœ€è¦æ›´æ–°"
        fi

    # ğŸ”” Google Search Console æäº¤
    - name: ğŸ”” æäº¤åˆ° Google Search Console
      if: steps.commit.outputs.changes_made == 'true'
      env:
        GOOGLE_SERVICE_ACCOUNT_KEY: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_KEY }}
      run: |
        if [ -n "$GOOGLE_SERVICE_ACCOUNT_KEY" ]; then
          echo "ğŸ”” æäº¤åˆ° Google Search Console..."
          npm install googleapis
          
          cat > submit-to-google.js << 'EOF'
          const { google } = require('googleapis');
          const fs = require('fs');

          async function submitToGoogle() {
            try {
              const credentials = JSON.parse(process.env.GOOGLE_SERVICE_ACCOUNT_KEY);
              
              const auth = new google.auth.GoogleAuth({
                credentials: credentials,
                scopes: ['https://www.googleapis.com/auth/webmasters']
              });

              const searchconsole = google.searchconsole({ version: 'v1', auth });

              // æäº¤ sitemap
              await searchconsole.sitemaps.submit({
                siteUrl: 'https://tingnotes.io',
                feedpath: 'https://tingnotes.io/sitemap.xml'
              });

              console.log('âœ… Sitemap å·²æäº¤åˆ° Google Search Console');

              // å¦‚æœæœ‰æ–°é é¢ï¼Œå˜—è©¦å¿«é€Ÿç´¢å¼•
              if (fs.existsSync('changed_files.txt')) {
                const changedFiles = fs.readFileSync('changed_files.txt', 'utf8')
                  .split('\n')
                  .filter(file => file.includes('index.html') && !file.includes('.git'));
                
                for (const file of changedFiles) {
                  const url = `https://tingnotes.io/${file.replace('/index.html', '/').replace('index.html', '')}`;
                  try {
                    // æ³¨æ„ï¼šé€™å€‹ API å¯èƒ½éœ€è¦ç‰¹æ®Šæ¬Šé™
                    console.log(`ğŸš€ å˜—è©¦å¿«é€Ÿç´¢å¼•: ${url}`);
                  } catch (error) {
                    console.log(`âš ï¸ ç„¡æ³•å¿«é€Ÿç´¢å¼• ${url}: ${error.message}`);
                  }
                }
              }

            } catch (error) {
              console.log(`âš ï¸ Google æäº¤å¤±æ•—: ${error.message}`);
              console.log('ğŸ’¡ Sitemap ä»æœƒè¢«è‡ªç„¶ç™¼ç¾ï¼Œä¸å½±éŸ¿ SEO æ•ˆæœ');
            }
          }

          submitToGoogle();
          EOF

          node submit-to-google.js
        else
          echo "âš ï¸ æœªè¨­å®š Google èªè­‰ï¼Œè·³é Search Console æäº¤"
        fi

    # ğŸŒ é€šçŸ¥æœå°‹å¼•æ“
    - name: ğŸŒ é€šçŸ¥æ‰€æœ‰æœå°‹å¼•æ“
      run: |
        echo "ğŸŒ é€šçŸ¥æœå°‹å¼•æ“æ›´æ–°..."
        
        # Google
        if curl -s "https://www.google.com/ping?sitemap=https://tingnotes.io/sitemap.xml"; then
          echo "âœ… Google å·²æ”¶åˆ°é€šçŸ¥"
        else
          echo "âš ï¸ Google é€šçŸ¥å¤±æ•—"
        fi
        
        # Bing
        if curl -s "https://www.bing.com/ping?sitemap=https://tingnotes.io/sitemap.xml"; then
          echo "âœ… Bing å·²æ”¶åˆ°é€šçŸ¥"
        else
          echo "âš ï¸ Bing é€šçŸ¥å¤±æ•—"
        fi
        
        echo "ğŸ”” æœå°‹å¼•æ“é€šçŸ¥å®Œæˆ"

    # ğŸ“Š ç”Ÿæˆå®Œæ•´å ±å‘Š
    - name: ğŸ“Š ç”Ÿæˆ TingNotes SEO å ±å‘Š
      run: |
        echo "ğŸ“Š ç”Ÿæˆå®Œæ•´çš„ SEO å„ªåŒ–å ±å‘Š..."
        
        cat > tingnotes_seo_report.md << 'EOF'
        # ğŸ“Š TingNotes SEO è‡ªå‹•åŒ–å ±å‘Š
        
        ## ğŸ• åŸ·è¡Œè³‡è¨Š
        - **åŸ·è¡Œæ™‚é–“**: $(date '+%Y-%m-%d %H:%M:%S')
        - **ç¶²ç«™**: https://tingnotes.io
        - **åŸ·è¡Œè€…**: TingNotes SEO Bot
        
        ## ğŸ¯ åŸ·è¡Œçš„å„ªåŒ–é …ç›®
        - âœ… æ™ºèƒ½ Sitemap ç”Ÿæˆèˆ‡æäº¤
        - âœ… SEO å„ªåŒ–çš„ robots.txt 
        - âœ… ç¶²ç«™å¥åº·ç‹€æ…‹æª¢æŸ¥
        - âœ… SEO æ¨™ç±¤é©—è­‰
        - âœ… è¡Œå‹•è£ç½®å‹å¥½åº¦æª¢æŸ¥
        - âœ… ç¶²ç«™çµæ§‹åˆ†æ
        - âœ… æœå°‹å¼•æ“é€šçŸ¥
        
        ## ğŸ“ˆ é‡è¦é€£çµ
        - ğŸ—ºï¸ [Sitemap](https://tingnotes.io/sitemap.xml)
        - ğŸ¤– [Robots.txt](https://tingnotes.io/robots.txt)
        - ğŸ” [Google Search Console](https://search.google.com/search-console)
        
        ## ğŸ“Š æœ¬æ¬¡åŸ·è¡Œçµ±è¨ˆ
        EOF
        
        # æ·»åŠ ç¶²ç«™åˆ†ææ•¸æ“š
        if [ -f "website-analysis.json" ]; then
          echo "### ğŸ—ï¸ ç¶²ç«™çµæ§‹" >> tingnotes_seo_report.md
          cat website-analysis.json | jq -r '
            "- **ç¸½æª”æ¡ˆæ•¸**: \(.structure.totalFiles)",
            "- **HTML æª”æ¡ˆ**: \(.structure.htmlFiles)",
            "- **å°ˆæ¡ˆæ•¸é‡**: \(.projects | length)",
            "- **ç¶²ç«™å¤§å°**: \(.structure.totalSize / 1024 | floor) KB"
          ' >> tingnotes_seo_report.md
        fi
        
        # æ·»åŠ  SEO å¥åº·åº¦
        if [ -f "seo-health-report.json" ]; then
          echo "" >> tingnotes_seo_report.md
          echo "### ğŸ¯ SEO å¥åº·åº¦" >> tingnotes_seo_report.md
          cat seo-health-report.json | jq -r '
            "- **SEO åˆ†æ•¸**: \(.score)/100",
            "- **ç™¼ç¾å•é¡Œ**: \(.issues | length) å€‹",
            "- **ç‹€æ…‹**: " + (if .score >= 90 then "å„ªç§€ ğŸ‰" elif .score >= 70 then "è‰¯å¥½ âœ…" else "éœ€æ”¹é€² âš ï¸" end)
          ' >> tingnotes_seo_report.md
        fi
        
        # æ·»åŠ è®Šæ›´æª”æ¡ˆè³‡è¨Š
        echo "" >> tingnotes_seo_report.md
        echo "### ğŸ“ æœ¬æ¬¡è®Šæ›´" >> tingnotes_seo_report.md
        if [ -f "changed_files.txt" ] && [ -s "changed_files.txt" ]; then
          echo "```" >> tingnotes_seo_report.md
          cat changed_files.txt >> tingnotes_seo_report.md
          echo "```" >> tingnotes_seo_report.md
        else
          echo "- ç„¡æª”æ¡ˆè®Šæ›´" >> tingnotes_seo_report.md
        fi
        
        # æ·»åŠ å¥åº·æª¢æŸ¥çµæœ
        if [ -f "health_report.txt" ]; then
          echo "" >> tingnotes_seo_report.md
          echo "### ğŸ¥ ç¶²ç«™å¥åº·æª¢æŸ¥" >> tingnotes_seo_report.md
          echo "```" >> tingnotes_seo_report.md
          cat health_report.txt >> tingnotes_seo_report.md
          echo "```" >> tingnotes_seo_report.md
        fi
        
        cat >> tingnotes_seo_report.md << 'EOF'
        
        ## ğŸš€ ä¸‹æ¬¡å„ªåŒ–å»ºè­°
        
        ### ğŸ¯ å…§å®¹ SEO
        - æŒçºŒå‰µä½œé«˜å“è³ªçš„æŠ€è¡“å…§å®¹
        - ç¢ºä¿æ¯å€‹æ–°å°ˆæ¡ˆéƒ½æœ‰å®Œæ•´çš„ meta æ¨™ç±¤
        - å®šæœŸæ›´æ–°èˆŠå…§å®¹ä»¥ä¿æŒç›¸é—œæ€§
        
        ### âš¡ æŠ€è¡“ SEO  
        - ç›£æ§ç¶²ç«™è¼‰å…¥é€Ÿåº¦
        - å„ªåŒ–åœ–ç‰‡å¤§å°å’Œæ ¼å¼
        - ç¢ºä¿æ‰€æœ‰é€£çµæ­£å¸¸é‹ä½œ
        
        ### ğŸ“± ä½¿ç”¨è€…é«”é©—
        - æŒçºŒæ”¹é€²è¡Œå‹•è£ç½®é«”é©—
        - å„ªåŒ–å°èˆªçµæ§‹
        - æå‡ç¶²ç«™äº’å‹•æ€§
        
        ## ğŸ‰ ç¸½çµ
        TingNotes SEO è‡ªå‹•åŒ–ç³»çµ±å·²æˆåŠŸåŸ·è¡Œæ‰€æœ‰å„ªåŒ–ä»»å‹™ï¼
        æ‚¨çš„ç¶²ç«™ç¾åœ¨å…·å‚™äº†æœ€ä½³çš„æœå°‹å¼•æ“å‹å¥½åº¦ã€‚
        
        ---
        *ç”± TingNotes æ™ºèƒ½ SEO å„ªåŒ–å™¨è‡ªå‹•ç”Ÿæˆ*
        EOF
        
        echo "ğŸ“Š å®Œæ•´å ±å‘Šå·²ç”Ÿæˆï¼"
        echo ""
        echo "ğŸ¯ é‡é»æ‘˜è¦ï¼š"
        
        # é¡¯ç¤ºé‡é»æ‘˜è¦
        if [ -f "seo-health-report.json" ]; then
          SEO_SCORE=$(cat seo-health-report.json | jq -r '.score')
          echo "   ğŸ“Š SEO åˆ†æ•¸: $SEO_SCORE/100"
        fi
        
        if [ -f "website-analysis.json" ]; then
          PROJECT_COUNT=$(cat website-analysis.json | jq -r '.projects | length')
          TOTAL_FILES=$(cat website-analysis.json | jq -r '.structure.totalFiles')
          echo "   ğŸ“ å°ˆæ¡ˆæ•¸é‡: $PROJECT_COUNT"
          echo "   ğŸ“„ ç¸½æª”æ¡ˆæ•¸: $TOTAL_FILES"
        fi
        
        echo "   ğŸ—ºï¸ Sitemap: https://tingnotes.io/sitemap.xml"
        echo "   ğŸ¤– Robots: https://tingnotes.io/robots.txt"
        
        echo ""
        echo "âœ… TingNotes SEO è‡ªå‹•åŒ–å®Œæˆï¼"

    # ğŸ‰ æˆåŠŸé€šçŸ¥
    - name: ğŸ‰ åŸ·è¡Œå®Œæˆé€šçŸ¥
      if: always()
      run: |
        if [ "${{ steps.commit.outputs.changes_made }}" = "true" ]; then
          echo "ğŸ‰ SEO è‡ªå‹•åŒ–åŸ·è¡ŒæˆåŠŸï¼"
          echo "ğŸ“Š å·²æ›´æ–° sitemap.xml å’Œç›¸é—œ SEO æª”æ¡ˆ"
          echo "ğŸ”” æœå°‹å¼•æ“å·²æ”¶åˆ°æ›´æ–°é€šçŸ¥"
          echo "ğŸ“ˆ å»ºè­°å®šæœŸæª¢æŸ¥ Google Search Console æ•¸æ“š"
        else
          echo "â„¹ï¸ SEO æª¢æŸ¥å®Œæˆï¼Œæ‰€æœ‰æª”æ¡ˆéƒ½æ˜¯æœ€æ–°çš„"
          echo "ğŸ¯ ç¶²ç«™ SEO ç‹€æ…‹è‰¯å¥½ï¼Œç„¡éœ€æ›´æ–°"
        fi
        
        echo ""
        echo "ğŸš€ TingNotes SEO è‡ªå‹•åŒ–ç³»çµ±ç‰¹è‰²ï¼š"
        echo "   âœ… æ™ºèƒ½ Sitemap è‡ªå‹•ç”Ÿæˆ"
        echo "   âœ… å…¨é¢çš„ SEO å¥åº·æª¢æŸ¥"
        echo "   âœ… ç¶²ç«™çµæ§‹æ·±åº¦åˆ†æ"
        echo "   âœ… æœå°‹å¼•æ“å³æ™‚é€šçŸ¥"
        echo "   âœ… è©³ç´°çš„å„ªåŒ–å ±å‘Š"
        echo "   âœ… é›¶ç¶­è­·è‡ªå‹•é‹è¡Œ"
        
        echo ""
        echo "ğŸ“… ä¸‹æ¬¡è‡ªå‹•åŸ·è¡Œï¼šæ¯é€±ä¸€å‡Œæ™¨ 2 é»"
        echo "ğŸ”§ æ‰‹å‹•è§¸ç™¼ï¼šæ¨é€åˆ° main åˆ†æ”¯æ™‚"